<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Email Schedules</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</head>
<body>
<div class="container mt-5">
    <div class="justify-content-center d-flex">
        <a th:href="@{/}" class="text-decoration-none">
            <h2>Home</h2>
        </a>
    </div>
    <h2 class="mb-3">Email Schedules</h2>
    <a th:href="@{/schedules/create}" class="btn btn-primary mb-3">+ New Schedule</a>

    <!-- Hiển thị thông báo -->
    <div th:if="${message}" class="alert alert-success" th:text="${message}"></div>
    <div th:if="${error}" class="alert alert-danger" th:text="${error}"></div>

    <table class="table table-bordered table-striped table-hover align-middle">
        <thead class="table-light">
        <tr class="text-center">
            <th>ID</th>
            <th>Name</th>
            <th>Type</th>
            <th>Time / Cron</th>
            <th>Recipient</th>
            <th>Template</th>
            <th>Actions</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="schedule : ${schedules.content}">
            <td th:text="${schedule.id}"></td>
            <td th:text="${schedule.name}"></td>
            <td th:text="${schedule.type}"></td>
            <td>
                <span th:switch="${#strings.trim(schedule.type)}">
                    <span th:case="'CRON'" th:text="${schedule.cronExpression}"></span>
                    <span th:case="'DAILY'">8h sáng mỗi ngày</span>
                    <span th:case="'WEEKLY'">Sáng thứ 2 mỗi tuần</span>
                    <span th:case="'MONTHLY'">0h1p mỗi đầu tháng</span>
                </span>
            </td>
            <td th:text="${schedule.receiverEmail}"></td>
            <td th:text="${schedule.template != null ? schedule.template.name : 'N/A'}"></td>
            <td class="text-center">
                <a th:href="@{/schedules/update/{id}(id=${schedule.id})}" class="btn btn-warning btn-sm me-2">Edit</a>
                <a th:href="@{/schedules/delete/{id}(id=${schedule.id})}"
                   onclick="return confirm('Bạn có chắc muốn xóa lịch gửi này không?')"
                   class="btn btn-danger btn-sm">Delete</a>
            </td>
        </tr>
        </tbody>
    </table>

    <!-- Pagination -->
    <nav >
        <ul class="pagination justify-content-center">
            <li class="page-item" th:classappend="${currentPage == 0} ? 'disabled'">
                <a class="page-link" th:href="@{/schedules/list(page=${currentPage - 1}, size=5)}">Previous</a>
            </li>

            <li class="page-item" th:each="i : ${#numbers.sequence(0, totalPages - 1)}"
                th:classappend="${i == currentPage} ? 'active'">
                <a class="page-link" th:href="@{/schedules/list(page=${i}, size=5)}" th:text="${i + 1}"></a>
            </li>

            <li class="page-item" th:classappend="${currentPage == totalPages - 1} ? 'disabled'">
                <a class="page-link" th:href="@{/schedules/list(page=${currentPage + 1}, size=5)}">Next</a>
            </li>
        </ul>
    </nav>

</div>
</body>
</html>